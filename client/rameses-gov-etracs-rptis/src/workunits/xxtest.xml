<?xml version="1.0" encoding="UTF-8"?>
<workunit>
    <invokers>
        <!-- 
        <invoker folderid="/menu/test" action="init" caption="Test" target="popup" index="500" role="APPRAISER" />
        -->
    </invokers>
    
    <code lang="groovy">

<![CDATA[        

import com.rameses.rcp.common.*
import com.rameses.rcp.annotations.*
import com.rameses.osiris2.client.*
import com.rameses.gov.etracs.rpt.common.*;

public class TestController {
    
    @Binding
    def binding;
    
    def filename = 'd:\\Chrysanthemum.jpg';
    def targetfile = 'd:\\Chrysanthemum3.jpg';
    
    def header = [objid:'A', refid:'TEST', title:'TEST', filesize:0, ]
    
   void init(){
        println 'appenv-----------------'
        println OsirisContext.getClientContext().appEnv
        
        println 'env-----------------'
        println OsirisContext.env
        
        println 'ctx properties-----------------'
        OsirisContext.getClientContext().getProperties();
        
        println 'session env-----------------'
        OsirisContext.getSessionEnv()
        
        println 'session.env-----------------'
        OsirisContext.getSession().getEnv();
        
        println 'seson properties-----------------'
        OsirisContext.getSession().getProperties()
        
   }
    
    void upload(){
        DBImageUtil.getInstance().upload(header, filename);
        MsgBox.alert('Success.');
    }
    
    void delete(){
        DBImageUtil.getInstance().deleteImage(header.objid);
        MsgBox.alert('Success.');
    }
    
    void deleteAll(){
        DBImageUtil.getInstance().deleteAllImages(header.refid);
        MsgBox.alert('Success.');
    }

    void saveToFile(){
        DBImageUtil.getInstance().saveToFile(header.objid, targetfile);
        MsgBox.alert('Success.');
    }
    
    def runTest(){
        def entity = [
            objid: 'R-84ec4b3:14467dbaf0d:-7ffb',
            requirementtypeid:'RT-7f3d74d9:1445dc4a199:-7fee',
            handler:'default',
            refid:'F-84ec4b3:14467dbaf0d:-7fff',
            requirementtype: [name:'TITLE'],
        ]
        return InvokerUtil.lookupOpener('xxtest', [entity:entity]);
    }
            
}

]]>
</code>
    
    <pages>
        <page template="test.TestPage" />
    </pages>
</workunit>


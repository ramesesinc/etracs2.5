<workunit>
    <invokers>
        <invoker type="subdivision:info" action="init" caption="Tax Declarations" visibleWhen="#{entity.state == 'APPROVED'}" index="-1"/>
        <invoker type="consolidation:info" action="init" caption="Tax Declarations" visibleWhen="#{entity.state == 'APPROVED'}" index="-1"/>
    </invokers>
    <code >
    <![CDATA[
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*
        import com.rameses.osiris2.reports.*;
        
        public class TDInfoListingController
        {
            @Binding
            def binding;
            
            def svc;
            
            def entity;
            def selectedItem;
            def faases;
            
            void init(){
                faases = svc.getFaasListing(entity.objid);
            }
            
            def listHandler = [
                fetchList : { return faases; }
            ] as BasicListModel;
            
            
            def getOpener(){
                if (selectedItem)
                    return InvokerUtil.lookupOpener('td:report', [entity:selectedItem]);
                return null;
            }
            
            void printAll(){
                if (!MsgBox.confirm('Print all tax declarations?'))
                    return;
                    
                if (!faases) 
                    return;
                
                faases.each{
                    def o = InvokerUtil.lookupOpener('td:report:print', [entity:it]);
                    if (o){
                        o.handle.report.viewReport();
                        ReportUtil.print(o.handle.report.report, false);
                    }
                }
                
                MsgBox.alert('All tax declarations are successfully sent to the printer.')
            }
        
        }
        
    ]]>    
    </code>
    
<page>
    <page template="com.rameses.gov.etracs.rpt.common.TDInfoListPage" />
</page>    
</workunit>
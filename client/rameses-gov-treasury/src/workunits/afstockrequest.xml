<!-- REQUISITION ISSUE SLIP -->
<workunit extends="wtemplates/StockRequestController.xml">
    
    <invokers>
        <invoker type="home.action" caption="AF Request" action="create" index="1" role="COLLECTOR,AFO" target="window"/>
        <invoker type="quick_launcher" code="AFRIS" caption="Accountable Form RIS" action="create" index="1" role="COLLECTOR,AFO" target="window"/>
        <invoker folderid="/menu/txn/treasury" caption="AF Request" action="create" index="10" role="COLLECTOR,AFO"/>
        
        <invoker type="afrequest:create" caption="AF Request" action="create" role="COLLECTOR,AFO" target="window"/>
        <invoker type="afrequest:open" caption="AF Request" action="open" role="COLLECTOR,AFO" target="window"/>
        
        <!--
        <invoker type="stockrequest:type" caption="Issuance" reqtype="ISSUANCE" role="COLLECTOR"/>
        <invoker type="stockrequest:issuance:open" caption="Stock Issue Request" action="open"  target="window"/>
        <invoker type="formActions" caption="Reports" name="popupReports"   
            visibleWhen="#{mode == 'read' }" category="stockrequest:reports" />       
        -->    
        <invoker type="afris:type" caption="Collection" reqtype="ISSUANCE" role="COLLECTOR"/>
        <invoker type="afris:type" caption="Purchase Stock" reqtype="PURCHASE" role="AFO"/>
    </invokers>
    
    <code>
        <![CDATA[
        
        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*
        import com.rameses.osiris2.common.*
        import java.rmi.server.*;
        import com.rameses.enterprise.inventory.stock.*;
        
        class AFRIS extends StockRequestController {
        
            String title = "Request Accountable Form";
        
            def reqType;
            def reqTypes;
            
            @PropertyChangeListener
            def listener = [
                "reqType": {o->
                    entity.reqtype = o.properties.reqtype
                 }
            ]
            
            void create() {
                reqTypes = InvokerUtil.lookupOpeners( "afris:type", [:] );
                entity = [items:[]];
                entity.state = "DRAFT";
                entity.itemclass = "AF";
                super.create();
            }
            
            void open() {
                super.open();
                title = "Request Accountable Form - " + entity.reqno;
                reqTypes = InvokerUtil.lookupOpeners( "afris:type", [:] )
                reqType = reqTypes.find{ it.properties.reqtype == entity.reqtype }
            }
            
        }
        
        ]]>
    </code>
</workunit>
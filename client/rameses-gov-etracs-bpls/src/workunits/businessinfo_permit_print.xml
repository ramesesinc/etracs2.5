<workunit>
    <invokers>
       <invoker type="businessinfo:permits:formActions" caption="Print Permit" action="specifyDate" target="popup"/>
       <invoker type="businesspermit:print" index="50" action="viewReport"/>    

       <invoker type="formActions" caption="Back" action="_close" mnemonic="b" shortcut="ctrl B" /> 
       
    </invokers>
    
    <code>
        <![CDATA[    
        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*
        import com.rameses.osiris2.common.*
        import java.rmi.server.*;
        import com.rameses.osiris2.reports.*;
        
        class  BPPermitReportController  {
        
            @Service("ReportParameterService") 
            def paramsvc
            
            
            def entity;
            def data = [:];
            def title = "Business Permit"
            def reportPath = "com/rameses/gov/etracs/bpls/reports/permit/"
            
            @FormId
            def formId;
            
            @FormTitle
            def formTitle;
            
            void viewReport() {
                formId = "BPRMT-" + entity.objid;
                formTitle = "BPRMT-" + entity.appno;
                data.putAll( entity );
                data.permitno = entity.permit.permitno + "-" + entity.permit.version;
                data.ownername = entity.owner.name;
                data.apptype = entity.application.apptype;
                data.dtissued = entity.permit.dtissued;
                data.expirydate = entity.permit.expirydate;
                data.activeyear = entity.permit.activeyear;
                data.version = entity.permit.version;
                data.lobs = entity.application.lobs.collect { [name: it.name] };
                data.orlist = [];
                
                println "expiry date " + data.expirydate + " type " + data.expirydate.class.name;
                println "dt issued " + data.dtissued;
                println data.lobs;
                report.viewReport();
            } 
            
            def report = [
                getReportName : { return reportPath + "BusinessPermit.jasper" },
                getReportData : { return  data },
                getParameters : { return paramsvc.getStandardParameter() },
                getSubReports : { return [
                        new SubReport("BusinessPermitLOB", reportPath + "BusinessPermitLOB.jasper"),
                        new SubReport("BusinessPermitOR", reportPath + "BusinessPermitOR.jasper")
                    ] as SubReport[];
                }
            ] as ReportModel
         }   
        ]]>
    </code>
    
    <pages>
        <page template="com.rameses.osiris2.common.ui.ReportPreviewPage"/>
    </pages>
    
</workunit>
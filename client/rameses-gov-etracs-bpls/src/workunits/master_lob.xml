<workunit>
    <invokers>
        <invoker folderid="/explorer/master/bpls" action="create" caption="Line of Business"/>

                
        <invoker type="quick_launcher" code="LOB01" action="create" caption="Line of Business" xrole="MASTER_ENCODER" xpermission="lob.create"/>
        <invoker type="lob:create" action="init" caption="Line of Business" />
        <invoker type="lob:open" action="open" caption="Line of Business" />
    </invokers>
    <code>
        <![CDATA[

        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*

        class LobController extends CRUDController
        {   

            String serviceName = 'LobMasterService'
            String entityName  = 'lob'
            String prefixId    = 'LOB';
        
            def attribute;
            
            def getLookupAttribute() {
                return InvokerUtil.lookupOpener('lobattribute:lookup', [onselect:{ attr->
                    if( !entity.attributes ) entity.attributes = [];
                    if( !entity.attributes.find{ it.objid == attr.lobattributeid } ){
                        def a = [:];
                        a.lobid = entity.objid;
                        a.lobattributeid = attr.objid;
                        a.name = attr.name;
                        entity.attributes << a;
                    }
                }])
            }
            
            def attributeListHandler = [
                getColumns : {
                    return [
                        new Column(name:'name', caption:'Attribute'),
                    ]
                },
                onRemoveItem : { removeAttribute( it ) },
                fetchList    : { 
                    if(entity.attributes==null) entity.attributes = []; 
                    return entity.attributes 
                },
            ] as SubListModel

            void removeAttribute( item ) {
                if( MsgBox.confirm('Remove selected attribute?') ) {
                    entity.attributes.remove( item )
                }
            }
            
        }

        ]]>        
        
    </code>
    <pages>
        <page name="main" template="com.rameses.gov.etracs.bpls.lob.LobPage"/>
    </pages>
</workunit>
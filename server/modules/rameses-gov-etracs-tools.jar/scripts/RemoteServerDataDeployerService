import com.rameses.annotations.*;
import com.rameses.common.*;
import com.rameses.services.extended.*;
import com.rameses.util.*;

class RemoteServerDataDeployerService
{
	@PersistenceContext('main')
	def em
 
	@ActiveDB('remoteserver_data')	
	def adb

	@Service('CollectionTypeService')
	def collTypeSvc

	@Service('RevenueItemAccountService')
	def revSvc

	@Service('UserAdminService')
	def userSvc

	@Service('CashBookService')
	def cashbookSvc

	@ProxyMethod
	public void deployUpdates( entity ) {
		entity.data.colltypes.each{
			collTypeSvc.save(it);
		}
		entity.data.revitems.each{
			revSvc.save(it.item);
		}
		entity.data.users.each{ 
			userSvc.save(it.user);
			it.cashbooks.each{ cb ->
				cb = EntityUtil.mapToField(cb)
				cashbookSvc.save(cb);
			}
			it.memberships.each{m->
				m = EntityUtil.mapToField(m)
				adb.insertUserMembership(m)
			}
		}
	}
}

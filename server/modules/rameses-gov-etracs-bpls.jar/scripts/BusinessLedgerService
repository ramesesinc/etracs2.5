import com.rameses.annotations.*;
import com.rameses.services.extended.*;

class BusinessLedgerService {

	@ActiveDB("business")
	def em;

	@ProxyMethod
	public def getReceivables( def p ) {
		def list = em.getReceivables(p);
		list.each {
			it.balance = it.amount - it.amtpaid;
		}
		return list;
	}
	
	@ProxyMethod
	public def saveReceivable( def p ) {
		return em.save( p, "receivable");
	}

	@ProxyMethod
	public def removeReceivable( def p ) {
		return em.delete( p, "receivable");
	}

	@ProxyMethod
	public def getReceivablePayments( def p ) {
		return em.getReceivablePayments(p);
	}

	@ProxyMethod
	public def saveReceivablePayment( def p ) {
		em.updateReceivableAmtPaid([amtpaid: p.amtpaid, objid: p.receivableid]);
		return em.save( p, "receivable_payment");
	}

	@ProxyMethod
	public def removeReceivablePayment( def p ) {
		em.updateReceivableAmtPaid([amtpaid: (p.amtpaid*-1), objid: p.receivableid]);
		return em.delete( p, "receivable_payment");
	}
}
import com.rameses.annotations.*;
import com.rameses.util.*;
import java.rmi.server.*;
import com.rameses.services.extended.*;

public class BPApplicationRequirementInterceptor {

	@ActiveDB("bpapplication")
	def em;

	private void checkValidation(o) {
		def list = em.getRequirementsForValidation(o);
		if(list) {
			throw new Exception( "The ff. requirements must be fulfilled: \n" + list*.caption.join("\n") );
		}
	}

	@Before(pattern="BPApplicationService.submitForAssessment.*")
	public def checkBeforeAssessment(def evt) { 
		def o = evt.args[0];
		checkValidation( [objid: o.objid, step: 'assessment' ]);
	}

	@Before(pattern="BPApplicationService.submitForPayment.*")
	public def checkBeforePayment(def evt) { 
		def o = evt.args[0];
		checkValidation( [objid: o.objid, step: 'payment' ]);
	}


}
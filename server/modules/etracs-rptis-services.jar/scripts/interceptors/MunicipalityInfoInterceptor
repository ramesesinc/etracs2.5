import com.rameses.annotations.*
import com.rameses.common.*;

class MunicipalityInfoInterceptor
{

	@Service('MunicipalityLookupService')
	def muniSvc 


	def STATE_FORPROVSUBMISSION = 'FORPROVSUBMISSION'
	
	@Before(pattern="FAASService.submitFaasForApproval", eval="#{args[0].rpu.rp.lgutype == 'municipality' && args[0].state == 'INTERIM'}") 
	public void submitFaasForApproval( evt ) {
		def faas = evt.args[0]
		faas.state = STATE_FORPROVSUBMISSION
	}


	@Before(pattern="SubdivisionService.submitForApproval", eval="#{args[0].motherfaas.lgutype == 'municipality' && args[0].state == 'DRAFT'}") 
	public void submitSubdivisionForApproval( evt ) {
		def subdivision = evt.args[0]
		subdivision.state = STATE_FORPROVSUBMISSION
	}


	@Before(pattern="ConsolidationService.submitForApproval", eval="#{args[0].lgutype == 'municipality' && args[0].state == 'DRAFT'}") 
	public void submitConsolidationForApproval( evt ) {
		def consolidation = evt.args[0]
		consolidation.state = STATE_FORPROVSUBMISSION
	}


	@After(pattern="RPUService.getLgus", eval="#{'municipality'.equals(args[0])}")
	public void getLgus(evt){
		def list = evt.result 
		list.addAll( muniSvc.lookupMunicipalities([:]) )
	}
}


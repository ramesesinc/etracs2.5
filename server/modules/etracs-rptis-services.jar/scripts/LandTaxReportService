import com.rameses.annotations.*
import com.rameses.common.*;

class LandTaxReportService
{
    @PersistenceContext('rpt')
    def em
     
	@Service('DateService')
    def dateSvc
	
	@Service('NumberService')
    def numSvc

    @Service('BarangayLookupService')
    def brgySvc 
	
	@Service('Var')
	def var 

	@Service('RPTUtil')
	def util

	
	@Env
	def env
	

	@ProxyMethod
	public def generateDelinquencyReport(params){
		util.required('Barangay', params.barangay)
		return em.sqlContext.createNamedQuery('landtaxreport:generateDelinquencyReport')
				.setParameter('barangayid', params.barangay.objid)
				.setParameter('currentyear', dateSvc.serverYear)
				.resultList
	}

	@ProxyMethod
	public def generateDelinquencyReportOldFormat(params){
		util.required('Barangay', params.barangay)
		return em.sqlContext.createNamedQuery('landtaxreport:generateDelinquencyReportOldFormat')
				.setParameter('barangayid', params.barangay.objid)
				.setParameter('currentyear', dateSvc.serverYear)
				.resultList.each{
					it.yearsdelinquent = util.toInteger(it.yearsdelinquent)
				}
	} 

	@ProxyMethod
	public def getBarangays( params ) {
		return brgySvc.lookupBarangays(params) 
	}

	@ProxyMethod 
	public def getMonths(param){
		return dateSvc.getMonths();
	}

}	